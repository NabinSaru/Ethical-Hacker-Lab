# NMAP

## NMAP Top 5

```sh
nmap -sn 192.168.1.0/24 # Ping scan
nmap --top-ports 20 192.168.1.1 # Top ports
nmap -O 192.168.1.1 # OS detection
nmap -A 192.168.1.1 # Aggressive scan: OS, Version, Trace route
nmap -p 80 192.168.1.1 # Port assignment
```

## Ping scan

Ping scan use the ARP protocol to discover the network devices. It scans for the port 80 and 443 in the Ping scan mode.

```sh
nmap -sn 192.168.1.0/24 # Quick native TCP connection mode
sudo nmap -sn 192.168.1.0/24 # Addittionally enable ICMP ping
```

NMAP by default use the TCP scan only as ICMP may not be responded by the devices. UDP scan can be performed by adding flag `-sU` and ICMP by running the scan in the root privileges.

## Stealth Scan

This relies on the incomplete handshake for the connection. The source doesn't response with ACK after getting SYN, ACK. This cause the destination to maintain any incomplete handshake log.

```nmap -sS 192.168.1.1```

However, on inspecting the packet in the transmission (traffic), the window size of packet is 1024 i.e. default by the NMAP which may be different from the maximum segment size. Hence, TCP SYN packet with window size value 1024 is likely to be generated by NMAP.

## TCP Connect Scan

This use the full TCP connection handshake as a result may be logged in the destination.

```nmap -sT 192.168.1.1```

## Null, Fin, Ack and Xmas scan

```sh
sudo nmap -sF 192.168.1.1 # Fin scan
sudo nmap -sA 192.168.1.1 # Ack scan
sudo nmap -sN 192.168.1.1 # Null scan
sudo nmap -sX 192.168.1.1 # x-mas scan
```

These scan relies on the fact that the response to the invalid package (null) or invalid handshake responses. For an example, consider the FIN scan, if FIN packet is sent without SYN or proper handshake. If RST is sent back, this mean the port is open. These may still apply to the older IOT devices enumeration but is mitigated by modern firewalls. Modern firewalls are stateful: designed to drop the packets that don't follow protocol or is invalid.

## UDP Scan

More and more applications are adopting the UDP protocol instead of the TCP. For example, DNS, chargen, ntp e.t.c. UDP scan are relatively time-consuming so port specification is important in order to filter out the unwanted traffic.

```sudo nmap -sU -p19,53,123 192.168.1.1```

Consider the following NMAP response for the scanme.nmap.org.

```sh
sudo nmap -sU -p19,53,123 scanme.nmap.org
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-10 09:03 EST
Nmap scan report for scanme.nmap.org (45.33.32.156)
Host is up (0.35s latency).

PORT    STATE         SERVICE
19/udp  closed        chargen
53/udp  open|filtered domain
123/udp open          ntp
```

Here chargen service is closed because the ICMP header specify that the destination/port is unreachable. ntp is open because it receives the valid response from the destination. Open/filtered on the other hand may be due to the fact that the application may not generate any response for the datagram as lacks the data in the data field and the application don't have any idea with how to proceed with the null data. Or, the packet is filtered by firewall. Hence, open/filtered state.

